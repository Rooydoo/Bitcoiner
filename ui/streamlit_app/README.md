# CryptoTrader Streamlit Dashboard

暗号資産自動売買システムの可視化ダッシュボードです。

## 機能

### 📊 共和分分析（新機能）

2つの暗号資産ペアの共和分関係を分析し、ペアトレーディングのためのスプレッドとZスコアを可視化します。

**主要機能:**
- ✅ 共和分検定（Engle-Granger test）
- ✅ 価格比較チャート（正規化 & ヘッジ調整後）
- ✅ スプレッドチャート（価格乖離の可視化）
- ✅ Zスコアチャート（エントリー/エグジットポイント表示）
- ✅ リアルタイムトレーディングシグナル
- ✅ 統計情報の表示

**可視化内容:**

1. **価格比較チャート**
   - 上段: 正規化された価格推移（開始値=100）
   - 下段: 資産1の価格 vs ヘッジ比率調整後の資産2の価格

2. **スプレッドチャート**
   - スプレッド = 資産1の価格 - ヘッジ比率 × 資産2の価格
   - 平均線とゼロラインの表示

3. **Zスコアチャート**
   - スプレッドを標準化したZスコア
   - エントリーシグナル（閾値超過時）
   - エグジットシグナル（平均回帰時）
   - ロング/ショートポイントのマーカー表示

## 起動方法

### 1. 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

### 2. 環境変数の設定

`.env`ファイルを作成し、以下を設定してください：

```bash
# Streamlit認証情報
STREAMLIT_USERNAME=admin
STREAMLIT_PASSWORD=your_password_here
```

### 3. Streamlitアプリの起動

```bash
cd ui/streamlit_app
streamlit run app.py
```

または、プロジェクトルートから：

```bash
streamlit run ui/streamlit_app/app.py
```

デフォルトでは `http://localhost:8501` でアクセスできます。

## 使い方

### 共和分分析の実行手順

1. **ログイン**: 環境変数で設定したユーザー名とパスワードでログイン
2. **ページ選択**: サイドバーから「共和分分析」を選択
3. **ペア設定**:
   - 資産1と資産2を選択（異なるシンボルを選択）
   - 時間足を選択（1h, 4h, 1d）
   - ルックバック期間を調整（50〜1000データポイント）
4. **シグナル閾値設定**:
   - エントリーZスコア閾値（デフォルト: 2.0）
   - エグジットZスコア閾値（デフォルト: 0.5）
5. **分析実行**: 「🔍 分析実行」ボタンをクリック

### 分析結果の見方

#### 共和分検定結果

- **共和分関係**: ペアが共和分関係にあるかどうか（p値 < 0.05で有意）
- **p値**: 統計的有意性（小さいほど信頼性が高い）
- **ヘッジ比率**: 資産2に対する資産1の係数（β）

#### トレーディングシグナル

- **🟢 ロング**: Zスコアが -2.0 以下 → 資産1買い、資産2売り
- **🔴 ショート**: Zスコアが +2.0 以上 → 資産1売り、資産2買い
- **⚪ クローズ**: Zスコアが ±0.5 以内 → ポジションクローズ
- **⏸️ ホールド**: それ以外 → ポジション維持

#### チャートの読み方

**価格比較チャート:**
- 正規化価格で両資産の動きを比較
- ヘッジ調整後の価格で実際のスプレッドを確認

**スプレッドチャート:**
- 平均線（赤の破線）からの乖離を確認
- 大きく乖離するとエントリーチャンス

**Zスコアチャート:**
- 赤い破線（±2.0）を超えるとエントリーシグナル
- オレンジの点線（±0.5）以内でエグジットシグナル
- 青い三角（▲）: ロングポイント
- 赤い逆三角（▼）: ショートポイント

## データベース要件

共和分分析を実行するには、データベースに価格データが必要です。

### 必要なデータ

- テーブル: `ohlcv`
- カラム: `symbol`, `timeframe`, `timestamp`, `open`, `high`, `low`, `close`, `volume`

### データ収集

価格データの収集は以下のスクリプトで実行できます：

```bash
# データ収集スクリプトを実行
python data/collector/data_orchestrator.py
```

または、メイントレーダーを起動すると自動的にデータ収集が開始されます：

```bash
python main_trader.py
```

## トラブルシューティング

### エラー: データが見つかりません

**原因**: データベースに選択したシンボルの価格データが存在しない

**解決策**:
1. データ収集スクリプトを実行してデータを取得
2. 別のシンボルペアを選択
3. データベースファイル `database/price_data.db` の存在を確認

### エラー: データポイント数が不足しています

**原因**: 取得できたデータが50ポイント未満

**解決策**:
1. より長期間データを収集
2. より短い時間足を選択（1h → 1d）
3. ルックバック期間を減らす

### 共和分関係が「なし」と表示される

**原因**: 選択したペアに統計的な共和分関係がない

**解決策**:
1. 別のペアを試す
2. 期間を変更する
3. p値を確認（0.05以下なら有意）

## 技術詳細

### 共和分検定アルゴリズム

1. **Engle-Granger二段階検定法**:
   - ステップ1: OLS回帰でヘッジ比率を計算
   - ステップ2: 残差（スプレッド）のADF検定で定常性を確認

2. **Zスコア計算**:
   ```
   Z = (spread - mean(spread)) / std(spread)
   ```

3. **半減期**:
   - Ornstein-Uhlenbeck過程を仮定
   - 平均回帰速度から計算

### 使用ライブラリ

- `streamlit`: Webアプリケーションフレームワーク
- `plotly`: インタラクティブチャート
- `pandas`: データ処理
- `statsmodels`: 統計解析（共和分検定）
- `numpy`: 数値計算

## 今後の拡張予定

- [ ] 複数ペアの同時分析
- [ ] バックテスト機能
- [ ] リアルタイム更新
- [ ] アラート機能
- [ ] ポートフォリオ最適化

## ライセンス

プロジェクトのライセンスに従います。
